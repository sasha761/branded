{% extends "base.twig" %}

{% block content %}
  <main class="p-shop p-search">
    <div class="u-container">

      {{breadcrumbs}}
      
      <div class="p-shop__flex">

        <div class="p-shop__sidebar">
          {% include 'templates/partial/sidebar.twig' %}
        </div>
        <div class="p-shop__catalog"> 
          <section class="l-shop">

            <h1 class="u-h3">{{ 'You searched' | translateString('Search - You searched') }}: {{title}}</h1>

            {# <pre>{{dump(posts.found_posts)}}</pre> #}
            <div class="l-shop__result">
              <div class="l-shop__result-count">{{ function('woocommerce_result_count') }}</div>
              {% if is_mobile == false %}
                <div class="c-sort js-filter-sort">
                  {{ function('woocommerce_catalog_ordering') }}
                </div> 
              {% endif %}
            </div>

              <div class="l-shop__product">
                {% if (posts.found_posts > 0) %}
                  <div class="row js-load-more">
                    {% for post in posts %}
                      <div class="col-lg-3 col-md-4 col-sm-6 col-6 u-col js-gallery-item">
                        {% include 'templates/partial/product.twig' with {'data': post} %}
                      </div>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="p-shop__nofound">
                    <h2 class="u-h2 is-center">{{ 'Sorry, your query did not find anything' | translateString('Search - empty') }}К сожалению по вашему запросу ничего не найдено</h2>
                  </div>
                {% endif %}
                
              </div>

              {% include 'partial/pagination.twig' with { pagination: posts.pagination({show_all: false, mid_size: 4, end_size: 1}) } %}

            </section>
          </div>

      </div>
    </div>

    {% include 'templates/partial/subscribe.twig' %}
  </main>

  <script>
    const products = document.querySelectorAll('[data-id]');

    if (products.length) {
      let productsIds = [];
      products.forEach((item, index) => {
        productsIds[index] = {
          'id': item.getAttribute('data-id'),
          'google_business_vertical': 'retail'
        }
      });
      window.dataLayer = window.dataLayer || []; 
      dataLayer.push({
        'event': 'view_search_results',
        'items': productsIds
      });
    }
  </script>
{% endblock %}
